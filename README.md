# Introduction-to-Node-Express

<div class="section-inner sectionLayout--insetColumn"><p name="c129" id="c129" class="graf graf--p graf--leading">Node is a JavaScript environment built on the same JavaScript engine used in Google’s Chrome web browser. It has some great features that make it an attractive choice for building server-side application middle tiers, including web servers and web services for platform APIs.</p><p name="c26a" id="c26a" class="graf graf--p graf-after--p"><span class="markup--quote markup--p-quote is-other" name="anon_a7ac22e51f47" data-creator-ids="anon">The non-blocking event driven I/O model gives it very attractive performance, easily beating threaded server environments like PHP and Ruby on Rails, which block on I/O and handle multiple simultaneous users by spinning up separate threads for each.</span></p><p name="d808" id="d808" class="graf graf--p graf-after--p">I’ve ported production apps with tens of millions of users from both PHP and Ruby on Rails to Node, leading to 2x&#8202;—&#8202;10x improvements of both response handling time and the number of simultaneous users handled by a single server.</p><p name="69d0" id="69d0" class="graf graf--p graf-after--p"><strong class="markup--strong markup--p-strong">Node Features:</strong></p><ul class="postList"><li name="750a" id="750a" class="graf graf--li graf-after--p">Fast! (Non-blocking I/O by default).</li><li name="309d" id="309d" class="graf graf--li graf-after--li">Event driven.</li><li name="31a1" id="31a1" class="graf graf--li graf-after--li">First class networking.</li><li name="5289" id="5289" class="graf graf--li graf-after--li">First class streaming API.</li><li name="8256" id="8256" class="graf graf--li graf-after--li">Great standard libraries for interfacing with the OS, filesystem, etc…</li><li name="03d3" id="03d3" class="graf graf--li graf-after--li">Support for compiled binary modules when you need to extend Node’s capabilities with a lower-level language like C++.</li><li name="cdc9" id="cdc9" class="graf graf--li graf-after--li">Trusted and backed by large enterprises running mission-critical apps. (Adobe, Google, Microsoft, Netflix, PayPal, Uber, Walmart, etc…).</li><li name="8204" id="8204" class="graf graf--li graf-after--li">Easy to get started.</li></ul><h3 name="b3cb" id="b3cb" class="graf graf--h3 graf-after--li">Installing Node</h3><p name="041c" id="041c" class="graf graf--p graf-after--h3">Before we jump in, let’s make sure you’ve got Node installed. There are always two supported versions of Node, the Long Term Support version (stable), and the current release. For production projects, try the LTS version. If you want to play with cutting edge features from the future, pick the current version.</p><h4 name="8945" id="8945" class="graf graf--h4 graf-after--p">Windows</h4><p name="eed3" id="eed3" class="graf graf--p graf-after--h4">Hit the <a href="https://nodejs.org/en/" data-href="https://nodejs.org/en/" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">Node website</a> and click one of the big green install buttons.</p><h4 name="83e8" id="83e8" class="graf graf--h4 graf-after--p">Mac or&nbsp;Linux</h4><p name="19a1" id="19a1" class="graf graf--p graf-after--h4">If you’re on a Mac or Linux system, my favorite way to install Node is with nvm.</p><p name="7780" id="7780" class="graf graf--p graf-after--p">To install or update nvm, you can use the <a href="https://github.com/creationix/nvm/blob/v0.32.1/install.sh" data-href="https://github.com/creationix/nvm/blob/v0.32.1/install.sh" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">install script</a> using cURL:</p><pre name="3e04" id="3e04" class="graf graf--pre graf-after--p">curl -o- <a href="https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh" data-href="https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh</a> | bash</pre><p name="8f9a" id="8f9a" class="graf graf--p graf-after--pre">or Wget:</p><pre name="b222" id="b222" class="graf graf--pre graf-after--p">wget -qO- <a href="https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh" data-href="https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh" class="markup--anchor markup--pre-anchor" rel="nofollow" target="_blank">https://raw.githubusercontent.com/creationix/nvm/v0.32.1/install.sh</a> | bash</pre><p name="3a67" id="3a67" class="graf graf--p graf-after--pre">Once nvm is installed, you can use it to install any version of Node.</p><h3 name="b6da" id="b6da" class="graf graf--h3 graf-after--p">Hello, World!</h3><p name="76f6" id="76f6" class="graf graf--p graf-after--h3">Node &amp; Express are easy enough that you get a basic web server to serve “Hello, world!” in about 12 lines of code:</p><figure name="addf" id="addf" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 43.286%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/c82a63d3a6cdc58a694966db20a8e515?postId=90c431f9e6fd" data-media-id="c82a63d3a6cdc58a694966db20a8e515" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="/media/c82a63d3a6cdc58a694966db20a8e515?postId=90c431f9e6fd"></iframe></div><noscript class="js-progressiveMedia-inner">&lt;div class="iframeContainer"&gt;&lt;IFRAME width="700" height="250" src="/media/c82a63d3a6cdc58a694966db20a8e515?postId=90c431f9e6fd" data-media-id="c82a63d3a6cdc58a694966db20a8e515" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&gt;&lt;/IFRAME&gt;&lt;/div&gt;</noscript></div></div></figure><p name="56f3" id="56f3" class="graf graf--p graf-after--figure">Before this code will run, you’ll need to set up your app a little. Start by creating a new git repo:</p><pre name="9f76" id="9f76" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">mkdir my-node-app &amp;&amp; cd my-node-app<br>git init</code></pre><p name="4864" id="4864" class="graf graf--p graf-after--pre">You need a <code class="markup--code markup--p-code">package.json</code> file to store your apps configuration. To create one, use <code class="markup--code markup--p-code">npm</code>, which comes installed with Node:</p><pre name="95b1" id="95b1" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">npm init</code></pre><p name="135a" id="135a" class="graf graf--p graf-after--pre">Answer a few questions (app name, git repo, etc…) and you’ll be ready to roll. Then you’ll need to install Express:</p><pre name="3622" id="3622" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">npm install --save express</code></pre><p name="79a1" id="79a1" class="graf graf--p graf-after--pre">With the dependencies installed, you can run your app by typing:</p><pre name="b53f" id="b53f" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">node index.js</code></pre><p name="55bc" id="55bc" class="graf graf--p graf-after--pre">Test it with <code class="markup--code markup--p-code">curl</code>:</p><pre name="b455" id="b455" class="graf graf--pre graf-after--p">curl localhost:3000</pre><p name="bf8e" id="bf8e" class="graf graf--p graf-after--pre">Or visit <code class="markup--code markup--p-code">localhost:3000</code> in your browser.</p><p name="a1eb" id="a1eb" class="graf graf--p graf-after--p">That’s it! You’ve just built your first Node app.</p><h3 name="2615" id="2615" class="graf graf--h3 graf-after--p">Environment Variables</h3><p name="b9c3" id="b9c3" class="graf graf--p graf-after--h3">You can use environment variables to configure your Node application. That makes it easy to use different configurations in different environments, such as the developer’s local machine, a testing server, a staging server, and production servers.</p><p name="5e9e" id="5e9e" class="graf graf--p graf-after--p">You should also use environment variables to inject app secrets, such as API keys into the app, without checking them into source control. Some deployment environments let you use&nbsp;<code class="markup--code markup--p-code">.env</code> files that contain the configuration settings for your app, but then you’re left with the question, “how do I load the&nbsp;<code class="markup--code markup--p-code">.env</code> settings into environment variables that the app can use?”</p><p name="414c" id="414c" class="graf graf--p graf-after--p">For that, try <a href="https://github.com/motdotla/dotenv" data-href="https://github.com/motdotla/dotenv" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">dotenv</a> for Node:</p><pre name="74f6" id="74f6" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">npm install --save dotenv</code></pre><p name="76e4" id="76e4" class="graf graf--p graf-after--pre">Then add one line to the top of your entry file:</p><pre name="f8e3" id="f8e3" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">require('dotenv').config();</code></pre><p name="9e82" id="9e82" class="graf graf--p graf-after--pre">Now you can load the <code class="markup--code markup--p-code">port</code> setting from a&nbsp;<code class="markup--code markup--p-code">.env</code> file. Create a new file called&nbsp;<code class="markup--code markup--p-code">.env</code> in your project root with the following:</p><pre name="d40e" id="d40e" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">PORT=5150</code></pre><p name="af14" id="af14" class="graf graf--p graf-after--pre">Save it, and relaunch the app, and you should see:</p><pre name="ad29" id="ad29" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">listening on port 5150</code></pre><p name="92e3" id="92e3" class="graf graf--p graf-after--pre">You don’t want to check your&nbsp;<code class="markup--code markup--p-code">.env</code> file into Git, so add it to your&nbsp;<code class="markup--code markup--p-code">.gitignore</code> file. In fact, while we’re at it, let’s add some other stuff, too:</p><figure name="8276" id="8276" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 21.286%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/4af08dcc9d9336625f4985e46d66a51b?postId=90c431f9e6fd" data-media-id="4af08dcc9d9336625f4985e46d66a51b" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="/media/4af08dcc9d9336625f4985e46d66a51b?postId=90c431f9e6fd"></iframe></div><noscript class="js-progressiveMedia-inner">&lt;div class="iframeContainer"&gt;&lt;IFRAME width="700" height="250" src="/media/4af08dcc9d9336625f4985e46d66a51b?postId=90c431f9e6fd" data-media-id="4af08dcc9d9336625f4985e46d66a51b" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&gt;&lt;/IFRAME&gt;&lt;/div&gt;</noscript></div></div></figure><p name="44e1" id="44e1" class="graf graf--p graf-after--figure">You still want to document the settings that are required for your app, so I like to check in a copy of the&nbsp;<code class="markup--code markup--p-code">.env</code> file with app secrets redacted. New users of the app can copy the file, name it&nbsp;<code class="markup--code markup--p-code">.env</code>, customize the settings, and be off and running. I name the checked-in copy&nbsp;<code class="markup--code markup--p-code">.env.example</code> and include instructions for developers in the project’s <code class="markup--code markup--p-code">README.md</code> file.</p><pre name="fead" id="fead" class="graf graf--pre graf-after--p">PORT=5150<br>AWS_KEY=&lt;your AWS key here&gt;</pre><p name="6680" id="6680" class="graf graf--p graf-after--pre">Note that you should be careful that all the app secrets are all redacted in your&nbsp;<code class="markup--code markup--p-code">.env.example</code> file, as demonstrated.</p><blockquote name="5486" id="5486" class="graf graf--pullquote graf-after--p">Don’t check your app secrets into the Git repository.</blockquote><h3 name="d96e" id="d96e" class="graf graf--h3 graf-after--pullquote">Testing Node&nbsp;Apps</h3><p name="26ec" id="26ec" class="graf graf--p graf-after--h3">I like to test Node apps with <a href="https://github.com/visionmedia/supertest" data-href="https://github.com/visionmedia/supertest" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">Supertest</a>, which abstracts away http connection issues and provides a simple, Fluent API. For http endpoints, I use <a href="https://www.sitepoint.com/javascript-testing-unit-functional-integration/" data-href="https://www.sitepoint.com/javascript-testing-unit-functional-integration/" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">functional tests</a>, which means that I don’t worry about mocking databases and so on. I just hit the API with some values and expect a specific response back.</p><p name="abb8" id="abb8" class="graf graf--p graf-after--p">Here’s a simple example with Supertest and <a href="https://medium.com/javascript-scene/why-i-use-tape-instead-of-mocha-so-should-you-6aa105d8eaf4" data-href="https://medium.com/javascript-scene/why-i-use-tape-instead-of-mocha-so-should-you-6aa105d8eaf4" class="markup--anchor markup--p-anchor" target="_blank">Tape</a>:</p><figure name="1d92" id="1d92" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 55.857%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded is-imageLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/5e19e9e23b42e04328160b766d9f2c08?postId=90c431f9e6fd" data-media-id="5e19e9e23b42e04328160b766d9f2c08" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0" src="/media/5e19e9e23b42e04328160b766d9f2c08?postId=90c431f9e6fd"></iframe></div><noscript class="js-progressiveMedia-inner">&lt;div class="iframeContainer"&gt;&lt;IFRAME width="700" height="250" src="/media/5e19e9e23b42e04328160b766d9f2c08?postId=90c431f9e6fd" data-media-id="5e19e9e23b42e04328160b766d9f2c08" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&gt;&lt;/IFRAME&gt;&lt;/div&gt;</noscript></div></div></figure><p name="49c4" id="49c4" class="graf graf--p graf-after--figure">I also write <a href="https://medium.com/javascript-scene/what-every-unit-test-needs-f6cd34d9836d" data-href="https://medium.com/javascript-scene/what-every-unit-test-needs-f6cd34d9836d" class="markup--anchor markup--p-anchor" target="_blank">unit tests</a> for any smaller, reusable modules I use to build the API.</p><p name="8d94" id="8d94" class="graf graf--p graf-after--p">Note that instead of dealing with the network, we’re directly importing the express app. Supertest doesn’t need to read your app config to know what port to connect to. It handles all those details under the covers, but for this to work, you’ll want to export your app… in your app file:</p><pre name="0309" id="0309" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">module.exports = app;</code></pre><p name="da52" id="da52" class="graf graf--p graf-after--pre">For this and other reasons, I split my app into a couple different pieces, <code class="markup--code markup--p-code">app.js</code> where I build and configure the app itself, and <code class="markup--code markup--p-code">server.js</code>, where I import the app, handle the networking details, and call <code class="markup--code markup--p-code">app.listen()</code>.</p><h4 name="34cd" id="34cd" class="graf graf--h4 graf-after--p">Setting the Node&nbsp;Path</h4><p name="037c" id="037c" class="graf graf--p graf-after--h4">When you start splitting your app into modules, you may get sick of relative path requires like this:</p><pre name="6086" id="6086" class="graf graf--pre graf-after--p">const app = require('../../app');</pre><p name="ef55" id="ef55" class="graf graf--p graf-after--pre">Luckily, you don’t need to use them. Put your app files in a directory named <code class="markup--code markup--p-code">source</code> or <code class="markup--code markup--p-code">src</code> and then set the <code class="markup--code markup--p-code">NODE_PATH</code> environment variable. You can use <code class="markup--code markup--p-code">cross-env</code> to set environment variables so they’ll work cross-platform (read, run your app on Windows):</p><pre name="3fce" id="3fce" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">npm install --save cross-env</code></pre><p name="6fc6" id="6fc6" class="graf graf--p graf-after--pre">Then in your <code class="markup--code markup--p-code">package.json</code> scripts, you can safely set your environment variables:</p><figure name="6730" id="6730" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/6b51dfee9fda2bcdc9c8b8a88e38fd95?postId=90c431f9e6fd" data-media-id="6b51dfee9fda2bcdc9c8b8a88e38fd95" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0"></iframe></div><noscript class="js-progressiveMedia-inner">&lt;div class="iframeContainer"&gt;&lt;IFRAME width="700" height="250" src="/media/6b51dfee9fda2bcdc9c8b8a88e38fd95?postId=90c431f9e6fd" data-media-id="6b51dfee9fda2bcdc9c8b8a88e38fd95" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&gt;&lt;/IFRAME&gt;&lt;/div&gt;</noscript></div></div></figure><p name="8600" id="8600" class="graf graf--p graf-after--figure">With <code class="markup--code markup--p-code">NODE_PATH</code> set, you can require modules like this:</p><pre name="c633" id="c633" class="graf graf--pre graf-after--p">const app = require('app');</pre><p name="cd39" id="cd39" class="graf graf--p graf-after--pre">Much better!</p><h3 name="16b1" id="16b1" class="graf graf--h3 graf-after--p">Middleware</h3><p name="687c" id="687c" class="graf graf--p graf-after--h3"><a href="http://expressjs.com/" data-href="http://expressjs.com/" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">Express</a> is the most popular framework for Node apps, and it features middleware using continuation passing. When you want to run the same code for potentially many different routes, the right place for that code is probably middleware.</p><p name="d8b6" id="d8b6" class="graf graf--p graf-after--p">Middleware is a function that gets passed the request and response objects, along with a continuation function to call, called <code class="markup--code markup--p-code">next()</code>. Imagine you want to add a <code class="markup--code markup--p-code">requestId</code> to each request/response pair so that you can easily trace them back to the individual request when you’re debugging or searching your logs for something.</p><p name="70f6" id="70f6" class="graf graf--p graf-after--p">You can write some middleware like this:</p><figure name="8e51" id="8e51" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/ea432263da6e5cbe89e872b7fb2d4479?postId=90c431f9e6fd" data-media-id="ea432263da6e5cbe89e872b7fb2d4479" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0"></iframe></div><noscript class="js-progressiveMedia-inner">&lt;div class="iframeContainer"&gt;&lt;IFRAME width="700" height="250" src="/media/ea432263da6e5cbe89e872b7fb2d4479?postId=90c431f9e6fd" data-media-id="ea432263da6e5cbe89e872b7fb2d4479" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&gt;&lt;/IFRAME&gt;&lt;/div&gt;</noscript></div></div></figure><h3 name="e40c" id="e40c" class="graf graf--h3 graf-after--figure">Memory Management</h3><p name="ce5c" id="ce5c" class="graf graf--p graf-after--h3">Since Node is single-threaded, that means that all your users are going to be sharing the same memory space. In other words, unlike in the browser, you have to be careful not to store user-specific data in closures where other connections can get at it. For this reason, I like to use <code class="markup--code markup--p-code">res.locals</code> to store temporary user data that’s only available during that user’s request/response cycle:</p><figure name="87aa" id="87aa" class="graf graf--figure graf--iframe graf-after--p"><div class="aspectRatioPlaceholder is-locked"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 35.699999999999996%;"></div><div class="progressiveMedia js-progressiveMedia is-canvasLoaded" data-scroll="native"><img src="https://i.embed.ly/1/display/resize?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd&amp;width=40" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="75"></canvas><div class="iframeContainer"><iframe width="700" height="250" data-src="/media/224738d80e184c1380015637ba1d82dd?postId=90c431f9e6fd" data-media-id="224738d80e184c1380015637ba1d82dd" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" class="progressiveMedia-iframe js-progressiveMedia-iframe" allowfullscreen="" frameborder="0"></iframe></div><noscript class="js-progressiveMedia-inner">&lt;div class="iframeContainer"&gt;&lt;IFRAME width="700" height="250" src="/media/224738d80e184c1380015637ba1d82dd?postId=90c431f9e6fd" data-media-id="224738d80e184c1380015637ba1d82dd" data-thumbnail="https://i.embed.ly/1/image?url=https%3A%2F%2Favatars1.githubusercontent.com%2Fu%2F364727%3Fv%3D3%26s%3D400&amp;amp;key=4fce0568f2ce49e8b54624ef71a8a5bd" allowfullscreen frameborder="0"&gt;&lt;/IFRAME&gt;&lt;/div&gt;</noscript></div></div></figure><p name="ab2f" id="ab2f" class="graf graf--p graf-after--figure">This is also a better way to store the <code class="markup--code markup--p-code">requestId</code> mentioned above.</p><h3 name="f5d3" id="f5d3" class="graf graf--h3 graf-after--p">Debugging Node&nbsp;Apps</h3><p name="9f56" id="9f56" class="graf graf--p graf-after--h3">Node v6.4.x+ ships with an integrated Chrome debugger, so you can hook up Node to use the same tools you use to debug your JS apps in the browser.</p><p name="96c1" id="96c1" class="graf graf--p graf-after--p">To use it, simply add debugger statements anywhere you want to set a breakpoint, then run:</p><pre name="0db6" id="0db6" class="graf graf--pre graf-after--p">node --debug-brk --inspect source/app.js</pre><p name="24b9" id="24b9" class="graf graf--p graf-after--pre">Open the provided URL in the browser, and you’ll get an interactive debugging environment.</p><figure name="a18f" id="a18f" class="graf graf--figure graf-after--p"><div class="aspectRatioPlaceholder is-locked" style="max-width: 700px; max-height: 267px;"><div class="aspectRatioPlaceholder-fill" style="padding-bottom: 38.2%;"></div><div class="progressiveMedia js-progressiveMedia graf-image is-canvasLoaded" data-image-id="1*U0VOYcBh6FBzVhtsjqvf4Q.png" data-width="2762" data-height="1054" data-action="zoom" data-action-value="1*U0VOYcBh6FBzVhtsjqvf4Q.png" data-scroll="native"><img src="https://cdn-images-1.medium.com/freeze/max/30/1*U0VOYcBh6FBzVhtsjqvf4Q.png?q=20" crossorigin="anonymous" class="progressiveMedia-thumbnail js-progressiveMedia-thumbnail"><canvas class="progressiveMedia-canvas js-progressiveMedia-canvas" width="75" height="27"></canvas><img class="progressiveMedia-image js-progressiveMedia-image" data-src="https://cdn-images-1.medium.com/max/800/1*U0VOYcBh6FBzVhtsjqvf4Q.png"><noscript class="js-progressiveMedia-inner">&lt;img class="progressiveMedia-noscript js-progressiveMedia-inner" src="https://cdn-images-1.medium.com/max/800/1*U0VOYcBh6FBzVhtsjqvf4Q.png"&gt;</noscript></div></div></figure><p name="f083" id="f083" class="graf graf--p graf-after--figure">I use <code class="markup--code markup--p-code">--debug-brk</code> by default to tell it to break at the beginning, but you can leave it out. Remember, you’ll probably need to hit your route in a browser or from curl to trigger the route handlers and hit your breakpoints.</p><p name="95b9" id="95b9" class="graf graf--p graf-after--p">As you probably already know, Chrome’s dev tools are packed with valuable debugging insights. You can profile, inspect the memory management and watch for memory leaks, step through the code a line at a time, hover over variables to see values, etc…</p><h3 name="fa5a" id="fa5a" class="graf graf--h3 graf-after--p">Let it&nbsp;Crash</h3><p name="9439" id="9439" class="graf graf--p graf-after--h3">Processes crash. Like all things, your server’s runtime will probably encounter an error it can’t handle at some point. Don’t sweat it. Log the error, shut down the server, and launch a new instance.</p><p name="f65d" id="f65d" class="graf graf--p graf-after--p">What you absolutely must not do is this:</p><pre name="779a" id="779a" class="graf graf--pre graf-after--p"><code class="markup--code markup--pre-code">process.on('uncaughtException', (err) =&gt; {<br>  console.log('Oops!');<br>});</code></pre><p name="1974" id="1974" class="graf graf--p graf-after--pre">You must shut down the process when there is an uncaught exception, because by definition, if you don’t know what went wrong with the app, your app is in an unknown, undefined state, and just about anything could be going wrong.</p><p name="01df" id="01df" class="graf graf--p graf-after--p">You could be leaking resources. Your users may not be seeing the correct data. You could have all kinds of crazy, undefined behaviors. When there is an exception you haven’t specifically planned for, log the error, clean up whatever resources you can, and shut down the process.</p><p name="91bc" id="91bc" class="graf graf--p graf-after--p">I wrote a module to make graceful error handling easy with Node. Check out <a href="https://github.com/ericelliott/express-error-handler" data-href="https://github.com/ericelliott/express-error-handler" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">express-error-handler</a>.</p><h4 name="4d9b" id="4d9b" class="graf graf--h4 graf-after--p">Crash Recovery</h4><p name="ad1d" id="ad1d" class="graf graf--p graf-after--h4">There are a wide range of server monitor utilities to detect crashes and repair the service in order to keep things running smoothly, even in the face of unexpected exceptions.</p><p name="2a8c" id="2a8c" class="graf graf--p graf-after--p">I highly recommend <a href="http://pm2.keymetrics.io/" data-href="http://pm2.keymetrics.io/" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">PM2</a> for this. I use it, and it’s trusted by companies like Microsoft, IBM, and PayPal.</p><p name="5ed7" id="5ed7" class="graf graf--p graf-after--p">To install, run <code class="markup--code markup--p-code">npm install -g pm2</code>. Install locally using <code class="markup--code markup--p-code">npm install --save-dev pm2</code>. Then you can launch the app using <code class="markup--code markup--p-code">pm2 start source/app.js</code>.</p><p name="6e5b" id="6e5b" class="graf graf--p graf-after--p">You can manage running app instances with <code class="markup--code markup--p-code">pm2 list</code> and stop instances with <code class="markup--code markup--p-code">pm2 stop</code>. See the <a href="http://pm2.keymetrics.io/docs/usage/quick-start/" data-href="http://pm2.keymetrics.io/docs/usage/quick-start/" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">quick start</a> for details.</p><p name="c159" id="c159" class="graf graf--p graf-after--p">Bonus: PM2 can be configured to integrate with <a href="https://keymetrics.io/" data-href="https://keymetrics.io/" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">Keymetrics</a>, which can provide great insights into your production app instances with a friendly web interface.</p><h3 name="f759" id="f759" class="graf graf--h3 graf-after--p">Conclusion</h3><p name="a6c9" id="a6c9" class="graf graf--p graf-after--h3 graf--last">We’ve only just scratched the surface of Node. There’s a lot more to learn about, including session management, token authentication, API design, etc… I’ve covered some of those topics in much more depth in <a href="http://pjabook.com" data-href="http://pjabook.com" class="markup--anchor markup--p-anchor" rel="nofollow" target="_blank">“Programming JavaScript Applications”</a> (free online).</p></div>

<a href="https://medium.com/javascript-scene/introduction-to-node-express-90c431f9e6fd#.wo8bwwt0a">https://medium.com/javascript-scene/introduction-to-node-express-90c431f9e6fd#.wo8bwwt0a</a>
